# Система покупки транспортных билетов

Микросервис для билетов на транспорт, реализованная на Java/Spring с использованием REST API.

## Технологический стек
- **Язык**: Java 22
- **Фреймворк**: Spring Boot 3.2+
- **База данных**: PostgreSQL
- **Доступ к данным**: Spring JdbcTemplate
- **Кеширование**: Redis + RedisTemplate
- **Аутентификация**: JWT (Access + Refresh токены)
- **Межсервисное взаимодействие**: Kafka
- **Документация**: OpenAPI 3 (Swagger)
- **Сборка**: Maven
- **Контейнеризация**: Docker

## Функциональные возможности
### Основные функции
- Регистрация и аутентификация пользователей
- Просмотр доступных билетов с фильтрацией и пагинацией
- Покупка/возврат билетов
- Просмотр истории покупок
- Управление сущностями (маршруты, перевозчики, билеты)

### Дополнительные функции
1. **JWT-аутентификация**:
   - Access-токен (15 мин)
   - Refresh-токен (7 дней)
   - Обновление токенов
2. **Ролевая модель**:
   - Роли: `CUSTOMER` (покупатель) и `ADMIN` (администратор)
3. **Кеширование Redis**:
   - Кеширование истории покупок
   - Автоматическое обновление кеша
4. **Микросервисная архитектура**:
   - Основной сервис
   - Сервис истории покупок [здесь](https://github.com/VladFokin1/ConsumerTicketMicroservice)
   - Асинхронная коммуникация через Kafka

## Сущности системы
| Сущность       | Атрибуты                             |
|----------------|--------------------------------------|
| **Билет**      | Маршрут, дата/время, место, цена, статус |
| **Маршрут**    | Пункт отправления, назначения, перевозчик, длительность |
| **Перевозчик** | Название, телефон                   |
| **Пользователь**| Логин, пароль, ФИО, роль            |

## REST API Endpoints
### Аутентификация
| Метод | Путь               | Описание                     |
|-------|--------------------|------------------------------|
| POST  | /api/auth/register | Регистрация нового пользователя |
| POST  | /api/auth/login    | Получение JWT токенов        |
| POST  | /api/auth/refresh  | Обновление Access токена     |

### Работа с билетами
| Метод | Путь                        | Доступ    | Описание                          |
|-------|-----------------------------|-----------|-----------------------------------|
| GET   | /api/tickets/available      | CUSTOMER  | Поиск доступных билетов           |
| POST  | /api/tickets/purchase/{id}  | CUSTOMER  | Покупка билета                    |
| GET   | /api/tickets/purchased      | CUSTOMER  | История покупок (кешируется в Redis) |
| DELETE| /api/tickets/return/{id}    | CUSTOMER  | Возврат билета                    |

### Администрирование
 | Метод | Путь                     | Доступ | Описание               |
 |-------|--------------------------|--------|------------------------|
 | POST  | /api/admin/carriers      | ADMIN  | Добавление перевозчика |
 | PUT   | /api/admin/carriers/{id} | ADMIN  | Обновление перевозчика |
 | DELETE| /api/admin/carriers/{id} | ADMIN  | Удаление перевозчика   |
 | GET   | /api/admin/carriers      | ADMIN  | Список перевозчиков    |
 | POST  | /api/admin/routes        | ADMIN  | Добавление маршрута    |
 | PUT   | /api/admin/routes/{id}   | ADMIN  | Обновление маршрута    |
 | DELETE| /api/admin/routes/{id}   | ADMIN  | Удаление маршрута      |
 | GET   | /api/admin/routes        | ADMIN  | Список маршрутов       |
 | POST  | /api/admin/tickets       | ADMIN  | Добавление билета      |
 | PUT   | /api/admin/tickets/{id}  | ADMIN  | Обновление билета      |
 | DELETE| /api/admin/tickets/{id}  | ADMIN  | Удаление билета        |
 | GET   | /api/admin/tickets       | ADMIN  | Список билетов         |
> Полная документация API доступна через Swagger UI:  
> `http://localhost:8080/swagger-ui.html`

